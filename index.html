<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Biscuit-o's Files | Released Documents</title>

<link rel="icon" href="/favicon.png">

<style>
:root {
    --bg: #f6f7f9;
    --card: #ffffff;
    --text: #111827;
    --muted: #6b7280;
    --border: #e5e7eb;
    --accent: #2563eb;
}

* { box-sizing: border-box; }

body {
    margin: 0;
    background: var(--bg);
    font-family: system-ui, -apple-system, BlinkMacSystemFont,
                 "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: var(--text);
    transition: transform 1s ease-in-out;
}

body.spin {
    transform: rotate(360deg);
}

.header {
    background: var(--card);
    border-bottom: 1px solid var(--border);
}

.header-inner {
    max-width: 960px;
    margin: 0 auto;
    padding: 32px 24px;
}

.main {
    max-width: 960px;
    margin: 0 auto;
    padding: 32px 24px 64px;
}

.search input {
    width: 100%;
    padding: 14px 16px;
    font-size: 15px;
    border-radius: 10px;
    border: 1px solid var(--border);
}

.search input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(37,99,235,0.15);
}

.file-list {
    margin-top: 28px;
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.file {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 18px 20px;
    transition: 0.15s ease;
}

.file:hover {
    transform: translateY(-1px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.06);
}

.file-header {
    display: flex;
    justify-content: space-between;
}

.file-name a {
    color: var(--text);
    text-decoration: none;
    font-weight: 500;
}

.file:hover .file-name a {
    color: var(--accent);
}

.file-meta {
    font-size: 13px;
    color: var(--muted);
}

.matches {
    margin-top: 10px;
    font-size: 13px;
    color: var(--muted);
}

.empty {
    text-align: center;
    padding: 48px;
    color: var(--muted);
}
</style>
</head>

<body>

<div class="header">
    <div class="header-inner">
        <h1>Released Documents</h1>
        <p style="margin:0;color:var(--muted);font-size:14px;">
            Biscuit-O's Library · Public Access Archive · Satirical Material
        </p>
    </div>
</div>

<div class="main">
    <div class="search">
        <input
            id="searchBar"
            placeholder="Search inside documents…"
            onkeyup="filterFiles()"
        >
    </div>

    <div class="file-list" id="fileList">Loading…</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script>
let files = [];
let pdfIndex = {}; // { filename: fullText }

/* Load files and index PDFs */
async function loadFiles() {
    const res = await fetch("files.json");
    files = await res.json();
    renderFiles(files);
    indexPDFs();
}

/* Extract text from PDFs */
async function indexPDFs() {
    for (const file of files) {
        if (!file.toLowerCase().endsWith(".pdf")) continue;

        try {
            const pdf = await pdfjsLib.getDocument(`files/${file}`).promise;
            let text = "";

            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(i => i.str).join(" ") + " ";
            }

            pdfIndex[file] = text.toLowerCase();
        } catch {
            pdfIndex[file] = "";
        }
    }
}

/* Render files */
function renderFiles(list, matches = {}) {
    const container = document.getElementById("fileList");
    container.innerHTML = "";

    if (!list.length) {
        container.innerHTML = `<div class="empty">No documents found.</div>`;
        return;
    }

    list.forEach(file => {
        const ext = file.split(".").pop().toUpperCase();
        const div = document.createElement("div");
        div.className = "file";

        let matchHTML = "";
        if (matches[file]) {
            matchHTML = `
                <div class="matches">
                    ${matches[file].join(", ")}
                </div>
            `;
        }

        div.innerHTML = `
            <div class="file-header">
                <div class="file-name">
                    <a href="files/${file}" target="_blank">${file}</a>
                </div>
                <div class="file-meta">${ext}</div>
            </div>
            ${matchHTML}
        `;

        container.appendChild(div);
    });
}

/* Search inside PDFs */
function filterFiles() {
    const query = searchBar.value.trim().toLowerCase();
    if (!query) {
        renderFiles(files);
        return;
    }

    const words = query.split(/\s+/);
    const matchedFiles = [];
    const matches = {};

    for (const file of files) {
        const text = pdfIndex[file];
        if (!text) continue;

        let found = [];

        for (const word of words) {
            const count = text.split(word).length - 1;
            if (count > 0) {
                found.push(
                    count > 1
                        ? `"${word}" (${count})`
                        : `"${word}"`
                );
            }
        }

        if (found.length) {
            matchedFiles.push(file);
            matches[file] = found;
        }
    }

    renderFiles(matchedFiles, matches);
}

/* CTRL + G Easter Eggs */
document.addEventListener("keydown", e => {
    if (e.ctrlKey && e.key.toLowerCase() === "g") {
        e.preventDefault();
        const input = prompt("Enter access phrase:");

        if (input === "aidenfilesontop") {
            document.body.classList.add("spin");
            setTimeout(() => document.body.classList.remove("spin"), 1000);
        }
    }
});

loadFiles();
</script>

</body>
</html>
